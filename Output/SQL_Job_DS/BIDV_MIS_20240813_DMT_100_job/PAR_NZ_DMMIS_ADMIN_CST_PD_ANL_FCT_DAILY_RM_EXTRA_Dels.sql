SELECT 
		 TWT.CST_ID					CST_ID
       , TWT.PD_ID					PD_ID
	   , PD_DIM.PD_TP				PD_TP
	   , TWT.ORG_UNIT_ID 			ORG_UNIT_ID
       , NVL(CST_DIM.CST_DIM_ID, 999999)		CST_DIM_ID
       , PD_DIM.PD_DIM_ID			PD_DIM_ID
       , NVL(OU_DIM.ORG_UNIT_DIM_ID, 999999)						ORG_UNIT_DIM_ID
	   , NVL(SLRY_TVR_SEG_DIM.SLRY_TVR_SEG_DIM_ID, 999999)			SLRY_TVR_DIM_ID
       , NVL(GND_DIM.GND_DIM_ID, 999999)				GND_DIM_ID
       , NVL(BRTH_AGE_SEG_DIM.AGE_SEG_DIM_ID, 0)		CST_BRTH_AGE_SEG_DIM_ID
       , NVL(CST_DIM.CST_ADR, TWT.ADDR)					ADDR
       , NVL(OCP_DIM.OCP_DIM_ID, '999999')				OCP_DIM_ID
       , NVL(MAR_ST_DIM.MAR_ST_DIM_ID, '999999')		MAR_ST_DIM_ID
       , 999999					CST_HIER_DIM_ID
       , NVL(CST_LCS_DIM.CST_LIFE_CYC_ST_DIM_ID, '999999')			CST_LCS_TP_DIM_ID
       , NVL(TMP_CST_SEG.CST_TP_DIM_ID, 999999)						CST_TP_DIM_ID
            , NVL(TMP_CST_SEG.CST_MKT_SEG_DIM_ID, 999999)		CST_MKT_SEG_DIM_ID
	   , NVL(NVL(CST_RLTNP_AGE_SEG.RLTNP_AGE_SEG_DIM_ID,MAX_RLTNP_AGE.RLTNP_AGE_SEG_DIM_ID) , 999999)		CST_AGE_SEG_DIM_ID
       , NVL(CDR_DT_DIM.CDR_DT_DIM_ID, '999999')					TM_PRD_DIM_ID
       , NVL(CST_OU_DIM.ORG_UNIT_DIM_ID, 999999)					CST_ORG_UNIT_DIM_ID
       , NVL(CR_RSK_RTG_DIM.CR_RSK_RTG_DIM_ID, '999999')			CR_RSK_RTG_DIM_ID
       , NVL(CR_LMT_BAL_SEG.CR_LMT_SEG_DIM_ID, 999999)				CR_LMT_SEG_DIM_ID
       , NVL(IDY_CL_DIM.IDY_SML_ID_DIM_ID, '999999')				IDY_SML_ID_DIM_ID
       , NVL(AST_BAL_SEG.BAL_SEG_DIM_ID, 999999)					CST_AST_BAL_SEG_DIM_ID
       , NVL(LBY_BAL_SEG.BAL_SEG_DIM_ID, 999999)					CST_LBY_BAL_SEG_DIM_ID
       , NVL(PERF_ST_DIM.PERF_ST_DIM_ID, '999999')					CST_PERF_ST_DIM_ID
       , NVL(CST_RLTNP_OFCR.EMPE_DIM_ID,999999 )					CST_RLTNP_OFCR_DIM_ID
       , NVL(SRC_STM_DIM.SRC_STM_DIM_ID, '999999')	SRC_STM_DIM_ID
	   
       , NBR_OF_AR_TDY
       , NBR_OF_ACTIVE_AR_TDY
       , NBR_NEW_AR_TDY
       , NBR_CLS_AR_TDY	   
       , TOT_AST_CLS_BAL_AMT_TDY_LCY
       , TOT_LBY_CLS_BAL_AMT_TDY_LCY
       , TOT_AST_CLS_BAL_AMT_TDY_FCY
       , TOT_LBY_CLS_BAL_AMT_TDY_FCY	   
	   , TOT_AST_CLS_BAL_AMT_LMTH_LCY
       , TOT_LBY_CLS_BAL_AMT_LMTH_LCY		
	   , TOT_AST_CLS_BAL_AMT_LQTR_LCY
       , TOT_LBY_CLS_BAL_AMT_LQTR_LCY
	   , TOT_AST_CLS_BAL_AMT_LYR_LCY
       , TOT_LBY_CLS_BAL_AMT_LYR_LCY	

	   	, NVL(TWT_TDY.CST_PD_ST_CODE, TWT.CST_PD_ST_CODE)		CST_PD_ST_CODE
       , NVL(CST_PD_ST_DIM.CST_PD_ST_DIM_ID, 999999)		CST_PD_ST_DIM_ID
	   , TWT.CST_PD_ST_BRN_CODE		CST_PD_ST_BRN_CODE
       , NVL(CST_PD_ST_BRN_DIM.CST_PD_ST_DIM_ID, 999999)		CST_PD_ST_BRN_DIM_ID
	   , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	THEN NVL(TWT.NBR_NEW_AR_TDY , 0) ELSE NVL(TWT.NBR_NEW_AR_TDY , 0)+ NVL(PRE.NBR_NEW_AR_MTD, 0) END		NBR_NEW_AR_MTD  
	   , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	THEN NVL(TWT.NBR_CLS_AR_TDY , 0) ELSE NVL(TWT.NBR_CLS_AR_TDY , 0)+ NVL(PRE.NBR_CLS_AR_MTD, 0) END		NBR_CLS_AR_MTD 
	   , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.NBR_NEW_AR_TDY , 0)  ELSE NVL(TWT.NBR_NEW_AR_TDY , 0)+ NVL(PRE.NBR_NEW_AR_QTD, 0) END   	 NBR_NEW_AR_QTD  
	   , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.NBR_CLS_AR_TDY , 0)  ELSE NVL(TWT.NBR_CLS_AR_TDY , 0)+ NVL(PRE.NBR_CLS_AR_QTD, 0) END		 NBR_CLS_AR_QTD 
	   , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.NBR_NEW_AR_TDY , 0) ELSE NVL(TWT.NBR_NEW_AR_TDY , 0)+ NVL(PRE.NBR_NEW_AR_YTD, 0) END   NBR_NEW_AR_YTD  
	   , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.NBR_CLS_AR_TDY , 0) ELSE NVL(TWT.NBR_CLS_AR_TDY , 0)+ NVL(PRE.NBR_CLS_AR_YTD, 0) END	NBR_CLS_AR_YTD 
	  , NVL(PD_USG_ST_DIM.PD_USG_ST_DIM_ID, 999999)		PD_USG_ST_DIM_ID	
	    
		, NVL(TWT.TOT_FEE_INCM_AMT_TDY_LCY, 0)			TOT_FEE_INCM_AMT_TDY_LCY
		, CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	THEN NVL(TWT.TOT_FEE_INCM_AMT_TDY_LCY, 0) ELSE  NVL(PRE.TOT_FEE_INCM_AMT_MTD_LCY, 0) + NVL(TWT.TOT_FEE_INCM_AMT_TDY_LCY, 0) END			TOT_FEE_INCM_AMT_MTD_LCY
		, CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	      THEN NVL(TWT.TOT_FEE_INCM_AMT_TDY_LCY, 0)   ELSE NVL(TWT.TOT_FEE_INCM_AMT_TDY_LCY, 0) + NVL(PRE.TOT_FEE_INCM_AMT_QTD_LCY, 0)  END 		TOT_FEE_INCM_AMT_QTD_LCY
		, CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_FEE_INCM_AMT_TDY_LCY, 0) ELSE 	NVL(TWT.TOT_FEE_INCM_AMT_TDY_LCY, 0) + 	NVL(PRE.TOT_FEE_INCM_AMT_YTD_LCY, 0)  END 		TOT_FEE_INCM_AMT_YTD_LCY
						  
		, CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.NBR_OF_FNC_TXN_TDY , 0) ELSE NVL(TWT.NBR_OF_FNC_TXN_TDY , 0)+ NVL(PRE.NBR_OF_FNC_TXN_MTD, 0) END 	NBR_OF_FNC_TXN_MTD
		, CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
			THEN NVL(TWT.NBR_OF_FNC_TXN_TDY , 0)  ELSE NVL(TWT.NBR_OF_FNC_TXN_TDY , 0)+ NVL(PRE.NBR_OF_FNC_TXN_QTD, 0) END 	NBR_OF_FNC_TXN_QTD
		, CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.NBR_OF_FNC_TXN_TDY , 0) ELSE NVL(TWT.NBR_OF_FNC_TXN_TDY , 0)+ NVL(PRE.NBR_OF_FNC_TXN_YTD, 0) END	NBR_OF_FNC_TXN_YTD
		, twt.NBR_OF_FNC_TXN_TDY		NBR_OF_FNC_TXN_TDY	  
		
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.NBR_OF_NFNC_TXN_TDY , 0) ELSE NVL(TWT.NBR_OF_NFNC_TXN_TDY , 0)+ NVL(PRE.NBR_OF_NFNC_TXN_MTD, 0) END 	NBR_OF_NFNC_TXN_MTD
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.NBR_OF_NFNC_TXN_TDY , 0)  ELSE NVL(TWT.NBR_OF_NFNC_TXN_TDY , 0)+ NVL(PRE.NBR_OF_NFNC_TXN_QTD, 0) END 	NBR_OF_NFNC_TXN_QTD
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.NBR_OF_NFNC_TXN_TDY , 0) ELSE NVL(TWT.NBR_OF_NFNC_TXN_TDY , 0)+ NVL(PRE.NBR_OF_NFNC_TXN_YTD, 0) END	NBR_OF_NFNC_TXN_YTD
       , twt.NBR_OF_NFNC_TXN_TDY		NBR_OF_NFNC_TXN_TDY	

	   
	, CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1 THEN NVL(TWT.TOT_NBR_OF_CST_TXN_TDY, 0)	ELSE NVL(TWT.TOT_NBR_OF_CST_TXN_TDY, 0) + NVL(PRE.TOT_NBR_OF_CST_TXN_MTD, 0)	END		TOT_NBR_OF_CST_TXN_MTD
	, CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1  
		THEN NVL(TWT.TOT_NBR_OF_CST_TXN_TDY, 0)	ELSE NVL(TWT.TOT_NBR_OF_CST_TXN_TDY, 0) + NVL(PRE.TOT_NBR_OF_CST_TXN_QTD, 0)	END		TOT_NBR_OF_CST_TXN_QTD
	, CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1 THEN NVL(TWT.TOT_NBR_OF_CST_TXN_TDY, 0)	ELSE NVL(TWT.TOT_NBR_OF_CST_TXN_TDY, 0) + NVL(PRE.TOT_NBR_OF_CST_TXN_YTD, 0)	END		TOT_NBR_OF_CST_TXN_YTD
	, NVL(TWT.TOT_NBR_OF_CST_TXN_TDY, 0)						TOT_NBR_OF_CST_TXN_TDY
	
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_CST_CR_AMT_TDY_LCY , 0) ELSE NVL(TWT.TOT_CST_CR_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_CST_CR_AMT_MTD_LCY, 0) END 	TOT_CST_CR_AMT_MTD_LCY
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_CST_CR_AMT_TDY_LCY , 0)  ELSE NVL(TWT.TOT_CST_CR_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_CST_CR_AMT_QTD_LCY, 0) END 	TOT_CST_CR_AMT_QTD_LCY
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_CST_CR_AMT_TDY_LCY , 0) ELSE NVL(TWT.TOT_CST_CR_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_CST_CR_AMT_YTD_LCY, 0) END	TOT_CST_CR_AMT_YTD_LCY
       , twt.TOT_CST_CR_AMT_TDY_LCY		TOT_CST_CR_AMT_TDY_LCY
	   
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_CST_DB_AMT_TDY_LCY , 0) ELSE NVL(TWT.TOT_CST_DB_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_CST_DB_AMT_MTD_LCY, 0) END 	TOT_CST_DB_AMT_MTD_LCY
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_CST_DB_AMT_TDY_LCY , 0)  ELSE NVL(TWT.TOT_CST_DB_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_CST_DB_AMT_QTD_LCY, 0) END 	TOT_CST_DB_AMT_QTD_LCY
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_CST_DB_AMT_TDY_LCY , 0) ELSE NVL(TWT.TOT_CST_DB_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_CST_DB_AMT_YTD_LCY, 0) END	TOT_CST_DB_AMT_YTD_LCY
       , twt.TOT_CST_DB_AMT_TDY_LCY		TOT_CST_DB_AMT_TDY_LCY
	   
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_OTHR_CR_AMT_TDY , 0) ELSE NVL(TWT.TOT_OTHR_CR_AMT_TDY , 0)+ NVL(PRE.TOT_OTHR_CR_AMT_MTD, 0) END 	TOT_OTHR_CR_AMT_MTD
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_OTHR_CR_AMT_TDY , 0)  ELSE NVL(TWT.TOT_OTHR_CR_AMT_TDY , 0)+ NVL(PRE.TOT_OTHR_CR_AMT_QTD, 0) END 	TOT_OTHR_CR_AMT_QTD
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_OTHR_CR_AMT_TDY , 0) ELSE NVL(TWT.TOT_OTHR_CR_AMT_TDY , 0)+ NVL(PRE.TOT_OTHR_CR_AMT_YTD, 0) END	TOT_OTHR_CR_AMT_YTD
       , twt.TOT_OTHR_CR_AMT_TDY		TOT_OTHR_CR_AMT_TDY
	   
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_OTHR_DB_AMT_TDY , 0) ELSE NVL(TWT.TOT_OTHR_DB_AMT_TDY , 0)+ NVL(PRE.TOT_OTHR_DB_AMT_MTD, 0) END 	TOT_OTHR_DB_AMT_MTD
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_OTHR_DB_AMT_TDY , 0)  ELSE NVL(TWT.TOT_OTHR_DB_AMT_TDY , 0)+ NVL(PRE.TOT_OTHR_DB_AMT_QTD, 0) END 	TOT_OTHR_DB_AMT_QTD
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_OTHR_DB_AMT_TDY , 0) ELSE NVL(TWT.TOT_OTHR_DB_AMT_TDY , 0)+ NVL(PRE.TOT_OTHR_DB_AMT_YTD, 0) END	TOT_OTHR_DB_AMT_YTD
       , twt.TOT_OTHR_DB_AMT_TDY		TOT_OTHR_DB_AMT_TDY
	   
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_NBR_OF_CST_CR_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_CST_CR_TDY , 0)+ NVL(PRE.TOT_NBR_OF_CST_CR_MTD, 0) END 	TOT_NBR_OF_CST_CR_MTD
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_NBR_OF_CST_CR_TDY , 0)  ELSE NVL(TWT.TOT_NBR_OF_CST_CR_TDY , 0)+ NVL(PRE.TOT_NBR_OF_CST_CR_QTD, 0) END 	TOT_NBR_OF_CST_CR_QTD
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_NBR_OF_CST_CR_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_CST_CR_TDY , 0)+ NVL(PRE.TOT_NBR_OF_CST_CR_YTD, 0) END	TOT_NBR_OF_CST_CR_YTD
       , twt.TOT_NBR_OF_CST_CR_TDY		TOT_NBR_OF_CST_CR_TDY
	   
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_NBR_OF_CST_DB_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_CST_DB_TDY , 0)+ NVL(PRE.TOT_NBR_OF_CST_DB_MTD, 0) END 	TOT_NBR_OF_CST_DB_MTD
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_NBR_OF_CST_DB_TDY , 0)  ELSE NVL(TWT.TOT_NBR_OF_CST_DB_TDY , 0)+ NVL(PRE.TOT_NBR_OF_CST_DB_QTD, 0) END 	TOT_NBR_OF_CST_DB_QTD
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_NBR_OF_CST_DB_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_CST_DB_TDY , 0)+ NVL(PRE.TOT_NBR_OF_CST_DB_YTD, 0) END	TOT_NBR_OF_CST_DB_YTD
       , twt.TOT_NBR_OF_CST_DB_TDY		TOT_NBR_OF_CST_DB_TDY
	   
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_NBR_OF_OTHR_CR_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_OTHR_CR_TDY , 0)+ NVL(PRE.TOT_NBR_OF_OTHR_CR_MTD, 0) END 	TOT_NBR_OF_OTHR_CR_MTD
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_NBR_OF_OTHR_CR_TDY , 0)  ELSE NVL(TWT.TOT_NBR_OF_OTHR_CR_TDY , 0)+ NVL(PRE.TOT_NBR_OF_OTHR_CR_QTD, 0) END 	TOT_NBR_OF_OTHR_CR_QTD
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_NBR_OF_OTHR_CR_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_OTHR_CR_TDY , 0)+ NVL(PRE.TOT_NBR_OF_OTHR_CR_YTD, 0) END	TOT_NBR_OF_OTHR_CR_YTD
       , twt.TOT_NBR_OF_OTHR_CR_TDY		TOT_NBR_OF_OTHR_CR_TDY
	   
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_NBR_OF_OTHR_DB_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_OTHR_DB_TDY , 0)+ NVL(PRE.TOT_NBR_OF_OTHR_DB_MTD, 0) END 	TOT_NBR_OF_OTHR_DB_MTD
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_NBR_OF_OTHR_DB_TDY , 0)  ELSE NVL(TWT.TOT_NBR_OF_OTHR_DB_TDY , 0)+ NVL(PRE.TOT_NBR_OF_OTHR_DB_QTD, 0) END 	TOT_NBR_OF_OTHR_DB_QTD
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_NBR_OF_OTHR_DB_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_OTHR_DB_TDY , 0)+ NVL(PRE.TOT_NBR_OF_OTHR_DB_YTD, 0) END	TOT_NBR_OF_OTHR_DB_YTD
       , twt.TOT_NBR_OF_OTHR_DB_TDY		TOT_NBR_OF_OTHR_DB_TDY
	   
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_ACTV_TXN_CR_AMT_TDY_LCY , 0) ELSE NVL(TWT.TOT_ACTV_TXN_CR_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_ACTV_TXN_CR_AMT_MTD_LCY, 0) END 	TOT_ACTV_TXN_CR_AMT_MTD_LCY
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_ACTV_TXN_CR_AMT_TDY_LCY , 0)  ELSE NVL(TWT.TOT_ACTV_TXN_CR_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_ACTV_TXN_CR_AMT_QTD_LCY, 0) END 	TOT_ACTV_TXN_CR_AMT_QTD_LCY
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_ACTV_TXN_CR_AMT_TDY_LCY , 0) ELSE NVL(TWT.TOT_ACTV_TXN_CR_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_ACTV_TXN_CR_AMT_YTD_LCY, 0) END	TOT_ACTV_TXN_CR_AMT_YTD_LCY
       , twt.TOT_ACTV_TXN_CR_AMT_TDY_LCY		TOT_ACTV_TXN_CR_AMT_TDY_LCY
	   
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_PASSIVE_TXN_CR_AMT_TDY_LCY , 0) ELSE NVL(TWT.TOT_PASSIVE_TXN_CR_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_PASSIVE_TXN_CR_AMT_MTD_LCY, 0) END 	TOT_PASSIVE_TXN_CR_AMT_MTD_LCY
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_PASSIVE_TXN_CR_AMT_TDY_LCY , 0)  ELSE NVL(TWT.TOT_PASSIVE_TXN_CR_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_PASSIVE_TXN_CR_AMT_QTD_LCY, 0) END 	TOT_PASSIVE_TXN_CR_AMT_QTD_LCY
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_PASSIVE_TXN_CR_AMT_TDY_LCY , 0) ELSE NVL(TWT.TOT_PASSIVE_TXN_CR_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_PASSIVE_TXN_CR_AMT_YTD_LCY, 0) END	TOT_PASSIVE_TXN_CR_AMT_YTD_LCY
       , twt.TOT_PASSIVE_TXN_CR_AMT_TDY_LCY		TOT_PASSIVE_TXN_CR_AMT_TDY_LCY	   

       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_ACTV_TXN_DB_AMT_TDY_LCY , 0) ELSE NVL(TWT.TOT_ACTV_TXN_DB_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_ACTV_TXN_DB_AMT_MTD_LCY, 0) END 	TOT_ACTV_TXN_DB_AMT_MTD_LCY
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_ACTV_TXN_DB_AMT_TDY_LCY , 0)  ELSE NVL(TWT.TOT_ACTV_TXN_DB_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_ACTV_TXN_DB_AMT_QTD_LCY, 0) END 	TOT_ACTV_TXN_DB_AMT_QTD_LCY
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_ACTV_TXN_DB_AMT_TDY_LCY , 0) ELSE NVL(TWT.TOT_ACTV_TXN_DB_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_ACTV_TXN_DB_AMT_YTD_LCY, 0) END	TOT_ACTV_TXN_DB_AMT_YTD_LCY
       , twt.TOT_ACTV_TXN_DB_AMT_TDY_LCY		TOT_ACTV_TXN_DB_AMT_TDY_LCY
	   
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_PASSIVE_TXN_DB_AMT_TDY_LCY , 0) ELSE NVL(TWT.TOT_PASSIVE_TXN_DB_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_PASSIVE_TXN_DB_AMT_MTD_LCY, 0) END 	TOT_PASSIVE_TXN_DB_AMT_MTD_LCY
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_PASSIVE_TXN_DB_AMT_TDY_LCY , 0)  ELSE NVL(TWT.TOT_PASSIVE_TXN_DB_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_PASSIVE_TXN_DB_AMT_QTD_LCY, 0) END 	TOT_PASSIVE_TXN_DB_AMT_QTD_LCY
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_PASSIVE_TXN_DB_AMT_TDY_LCY , 0) ELSE NVL(TWT.TOT_PASSIVE_TXN_DB_AMT_TDY_LCY , 0)+ NVL(PRE.TOT_PASSIVE_TXN_DB_AMT_YTD_LCY, 0) END	TOT_PASSIVE_TXN_DB_AMT_YTD_LCY
       , twt.TOT_PASSIVE_TXN_DB_AMT_TDY_LCY		TOT_PASSIVE_TXN_DB_AMT_TDY_LCY	
 
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_NBR_OF_ACTV_TXN_CR_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_ACTV_TXN_CR_TDY , 0)+ NVL(PRE.TOT_NBR_OF_ACTV_TXN_CR_MTD, 0) END 	TOT_NBR_OF_ACTV_TXN_CR_MTD
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_NBR_OF_ACTV_TXN_CR_TDY , 0)  ELSE NVL(TWT.TOT_NBR_OF_ACTV_TXN_CR_TDY , 0)+ NVL(PRE.TOT_NBR_OF_ACTV_TXN_CR_QTD, 0) END 	TOT_NBR_OF_ACTV_TXN_CR_QTD
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_NBR_OF_ACTV_TXN_CR_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_ACTV_TXN_CR_TDY , 0)+ NVL(PRE.TOT_NBR_OF_ACTV_TXN_CR_YTD, 0) END	TOT_NBR_OF_ACTV_TXN_CR_YTD
       , twt.TOT_NBR_OF_ACTV_TXN_CR_TDY		TOT_NBR_OF_ACTV_TXN_CR_TDY
	   
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_NBR_OF_PASSIVE_TXN_CR_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_PASSIVE_TXN_CR_TDY , 0)+ NVL(PRE.TOT_NBR_OF_PASSIVE_TXN_CR_MTD, 0) END 	TOT_NBR_OF_PASSIVE_TXN_CR_MTD
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_NBR_OF_PASSIVE_TXN_CR_TDY , 0)  ELSE NVL(TWT.TOT_NBR_OF_PASSIVE_TXN_CR_TDY , 0)+ NVL(PRE.TOT_NBR_OF_PASSIVE_TXN_CR_QTD, 0) END 	TOT_NBR_OF_PASSIVE_TXN_CR_QTD
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_NBR_OF_PASSIVE_TXN_CR_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_PASSIVE_TXN_CR_TDY , 0)+ NVL(PRE.TOT_NBR_OF_PASSIVE_TXN_CR_YTD, 0) END	TOT_NBR_OF_PASSIVE_TXN_CR_YTD
       , twt.TOT_NBR_OF_PASSIVE_TXN_CR_TDY		TOT_NBR_OF_PASSIVE_TXN_CR_TDY	   

       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_NBR_OF_ACTV_TXN_DB_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_ACTV_TXN_DB_TDY , 0)+ NVL(PRE.TOT_NBR_OF_ACTV_TXN_DB_MTD, 0) END 	TOT_NBR_OF_ACTV_TXN_DB_MTD
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_NBR_OF_ACTV_TXN_DB_TDY , 0)  ELSE NVL(TWT.TOT_NBR_OF_ACTV_TXN_DB_TDY , 0)+ NVL(PRE.TOT_NBR_OF_ACTV_TXN_DB_QTD, 0) END 	TOT_NBR_OF_ACTV_TXN_DB_QTD
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_NBR_OF_ACTV_TXN_DB_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_ACTV_TXN_DB_TDY , 0)+ NVL(PRE.TOT_NBR_OF_ACTV_TXN_DB_YTD, 0) END	TOT_NBR_OF_ACTV_TXN_DB_YTD
       , twt.TOT_NBR_OF_ACTV_TXN_DB_TDY		TOT_NBR_OF_ACTV_TXN_DB_TDY
	   
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_MO = 1	then NVL(TWT.TOT_NBR_OF_PASSIVE_TXN_DB_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_PASSIVE_TXN_DB_TDY , 0)+ NVL(PRE.TOT_NBR_OF_PASSIVE_TXN_DB_MTD, 0) END 	TOT_NBR_OF_PASSIVE_TXN_DB_MTD
       , CASE WHEN TO_NUMBER(extract (day from TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') - date_trunc('quarter', TO_DATE(SYS.PARAM_VALUE,'YYYYDDD'))),99) + 1 = 1 
	     THEN NVL(TWT.TOT_NBR_OF_PASSIVE_TXN_DB_TDY , 0)  ELSE NVL(TWT.TOT_NBR_OF_PASSIVE_TXN_DB_TDY , 0)+ NVL(PRE.TOT_NBR_OF_PASSIVE_TXN_DB_QTD, 0) END 	TOT_NBR_OF_PASSIVE_TXN_DB_QTD
       , CASE WHEN CDR_DT_DIM.DAY_NBR_IN_CDR_YR = 1	THEN NVL(TWT.TOT_NBR_OF_PASSIVE_TXN_DB_TDY , 0) ELSE NVL(TWT.TOT_NBR_OF_PASSIVE_TXN_DB_TDY , 0)+ NVL(PRE.TOT_NBR_OF_PASSIVE_TXN_DB_YTD, 0) END	TOT_NBR_OF_PASSIVE_TXN_DB_YTD
       , twt.TOT_NBR_OF_PASSIVE_TXN_DB_TDY		TOT_NBR_OF_PASSIVE_TXN_DB_TDY	
		, CASE WHEN TWT_TDY.CLS_PD_IND = 1 THEN 'Y' ELSE 'N' END		CLS_PD_IND	 
		, NVL(CTY_DIM.CTY_DIM_ID,'999999')					CTY_OF_RSDNC_DIM_ID
		, NVL(EMPE_DIM.EMPE_DIM_ID, '999999')					EMPE_DIM_ID
	   
		, TWT.NBR_OF_DYS_HTD 		NBR_OF_DYS_HTD
		, TWT.NBR_OF_DYS_MTD 		NBR_OF_DYS_MTD 
		, TWT.NBR_OF_DYS_QTD	   	NBR_OF_DYS_QTD 
		, TWT.NBR_OF_DYS_YTD		NBR_OF_DYS_YTD 	 	

		, CASE WHEN TWT.TOT_NBR_OF_CST_TXN_TDY > 0 THEN	 TO_NUMBER(CDR_DT_DIM.CDR_DT_DIM_ID, 9999999)  ELSE PRE.LAST_CST_TXN_DT_DIM_ID END LAST_CST_TXN_DT_DIM_ID		       , 0 TOT_AST_ACR_INT_AMT_MTD_LCY
       , 0 TOT_AST_ACR_INT_AMT_QTD_LCY
       , 0 TOT_AST_ACR_INT_AMT_YTD_LCY
       , 0 TOT_AST_ACR_INT_AMT_TDY_LCY
       , 0 TOT_LBY_ACR_INT_AMT_MTD_LCY
       , 0 TOT_LBY_ACR_INT_AMT_QTD_LCY
       , 0 TOT_LBY_ACR_INT_AMT_YTD_LCY
       , 0 TOT_LBY_ACR_INT_AMT_TDY_LCY
       , 0 TOT_AST_INT_PYMT_AMT_MTD_LCY
       , 0 TOT_AST_INT_PYMT_AMT_QTD_LCY
       , 0 TOT_AST_INT_PYMT_AMT_TDY_LCY
       , 0  TOT_AST_INT_PYMT_AMT_YTD_LCY	 

       , 0      TOT_LBY_INT_PYMT_AMT_MTD_LCY
       , 0      TOT_LBY_INT_PYMT_AMT_QTD_LCY
       , 0      TOT_LBY_INT_PYMT_AMT_TDY_LCY
       , 0      TOT_LBY_INT_PYMT_AMT_YTD_LCY
       , 0      TOT_LBY_ACR_PNY_INT_PTD_LCY
       , 0      TOT_LBY_ACR_PNY_INT_MTD_LCY
       , 0      TOT_LBY_ACR_PNY_INT_QTD_LCY
       , 0      TOT_LBY_ACR_PNY_INT_TDY_LCY
       , 0      TOT_LBY_ACR_PNY_INT_YTD_LCY

		, 0 	NBR_OF_OD_AC
		, 'N' 	SLRY_CR_TXN_IND
		, NVL(TMP_CST_SEG.CST_CRT_DEPT_DIM_ID, 999999)		CST_CRT_DEPT_DIM_ID
		, NVL(TMP_CST_SEG.CST_MGT_DEPT_DIM_ID, 999999)		CST_MGT_DEPT_DIM_ID
		, NVL(TMP_CST_SEG.CST_SEG_DIM_ID, 999999)			CST_SEG_DIM_ID
FROM TWT_CST_PD_ANL_RM_EXTRA  TWT
LEFT JOIN (
	SELECT DISTINCT T.CST_ID,  T.PD_ID, T.SRC_STM_ID, T.CST_PD_ST_CODE, CLS_PD_IND
	FROM TWT_CST_PD_ANL_RM T
)TWT_TDY ON TWT_TDY.CST_ID = TWT.CST_ID AND TWT_TDY.SRC_STM_ID = TWT.SRC_STM_ID AND TWT_TDY.PD_ID = TWT.PD_ID

LEFT JOIN 		CSTB_SYSTEM SYS ON SYS.PARAM_NAME = 'ETL_DATE'
LEFT JOIN 		CDR_DT_DIM CDR_DT_DIM ON TWT.TM_PRD_ID = CDR_DT_DIM.CDR_DT_DIM_ID

LEFT JOIN  		CST_DIM CST_DIM 			ON CST_DIM.CST_ID = twt.CST_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= CST_DIM.EFF_FM_DT AND CST_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		OU_DIM OU_DIM 				ON TWT.ORG_UNIT_ID = OU_DIM.ORG_UNIT_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= OU_DIM.EFF_FM_DT AND OU_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		OU_DIM CST_OU_DIM 				ON TWT.CST_ORG_UNIT_ID = CST_OU_DIM.ORG_UNIT_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= CST_OU_DIM.EFF_FM_DT AND CST_OU_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN SRC_STM_DIM SRC_STM_DIM	ON SRC_STM_DIM.LVL_0_ID	= TWT.SRC_STM_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= SRC_STM_DIM.EFF_FM_DT AND SRC_STM_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')

INNER JOIN PD_DIM PD_DIM			ON PD_DIM.PD_ID = TWT.PD_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= PD_DIM.EFF_FM_DT AND PD_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		GND_DIM GND_DIM				ON GND_DIM.LVL_0_ID = TWT.GND_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= GND_DIM.EFF_FM_DT AND GND_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')

LEFT JOIN 		BRTH_AGE_SEG_DIM	BRTH_AGE_SEG_DIM			ON  BRTH_AGE_SEG_DIM.LVL_0_ID = TWT.CST_BRTH_AGE_SEG_ID	AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= BRTH_AGE_SEG_DIM.EFF_FM_DT AND BRTH_AGE_SEG_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		CST_RLTNP_AGE_SEG_DIM CST_RLTNP_AGE_SEG					ON 	CST_RLTNP_AGE_SEG.LVL_0_ID = TWT.CST_AGE_SEG_ID		AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= CST_RLTNP_AGE_SEG.EFF_FM_DT AND CST_RLTNP_AGE_SEG.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		(SELECT T1.LVL_0_ID, T2.RLTNP_AGE_SEG_DIM_ID  FROM (
                        SELECT MAX(LVL_0_ID) LVL_0_ID  FROM CST_RLTNP_AGE_SEG_DIM  T
                        INNER JOIN CSTB_SYSTEM SYS ON SYS.PARAM_NAME = 'ETL_DATE' AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= T.EFF_FM_DT AND T.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
                    ) T1
                INNER JOIN CST_RLTNP_AGE_SEG_DIM T2 ON T1.LVL_0_ID = T2.LVL_0_ID )  MAX_RLTNP_AGE			ON   TWT.CST_AGE_SEG_ID > MAX_RLTNP_AGE.LVL_0_ID
LEFT JOIN 		OCP_DIM OCP_DIM				ON OCP_DIM.LVL_0_ID = TWT.OCP_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= OCP_DIM.EFF_FM_DT AND OCP_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		CST_PD_ST_DIM ON CST_PD_ST_DIM.LVL_0_CODE = NVL(TWT_TDY.CST_PD_ST_CODE, TWT.CST_PD_ST_CODE) AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= CST_PD_ST_DIM.EFF_FM_DT AND CST_PD_ST_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		CST_LC_ST_DIM CST_LCS_DIM   ON CST_LCS_DIM.LVL_0_ID = TWT.CST_LCS_TP_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= CST_LCS_DIM.EFF_FM_DT AND CST_LCS_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		IDY_CL_DIM IDY_CL_DIM	    ON IDY_CL_DIM.LVL_0_ID = TWT.IDY_SML_ID_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= IDY_CL_DIM.EFF_FM_DT AND IDY_CL_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		MAR_ST_DIM MAR_ST_DIM		ON MAR_ST_DIM.LVL_0_ID = TWT.MAR_ST_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= MAR_ST_DIM.EFF_FM_DT AND MAR_ST_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		EMPE_DIM CST_RLTNP_OFCR		ON CST_RLTNP_OFCR.EMPE_ID = TWT.CST_RLTNP_OFCR_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= CST_RLTNP_OFCR.EFF_FM_DT AND CST_RLTNP_OFCR.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		CR_RSK_RTG_DIM  CR_RSK_RTG_DIM  ON CR_RSK_RTG_DIM.LVL_0_ID = TWT.CR_RSK_RTG_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= CR_RSK_RTG_DIM.EFF_FM_DT AND CR_RSK_RTG_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		PERF_ST_DIM PERF_ST_DIM		ON PERF_ST_DIM.LVL_0_ID = TWT.CST_PERF_ST_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= PERF_ST_DIM.EFF_FM_DT AND PERF_ST_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')

LEFT JOIN 		(
		SELECT 
			CASE WHEN TWT.CST_PD_ST_BRN_CODE  NOT IN ('CLOSE ALL', 'CLOSE ALL TODAY') THEN (
				CASE 	WHEN NVL(TWT.LAST_CST_TXN_DT_DIM_ID, FCT_PRE.LAST_CST_TXN_DT_DIM_ID) >= TO_NUMBER(TO_CHAR(add_months(TO_DATE(SYS.PARAM_VALUE, 'YYYYDDD'), -6), 'YYYYDDD'), 9999999) THEN 'USING'
						WHEN NVL(TWT.LAST_CST_TXN_DT_DIM_ID, FCT_PRE.LAST_CST_TXN_DT_DIM_ID) IS NULL THEN 'NOT_USE'
						ELSE 'DORMANT'
				END)
			ELSE 'UNKNOWN'
			END			PD_USG_ST_CODE,
			TWT.CST_ID,
			TWT.PD_ID, 
			TWT.ORG_UNIT_ID,
			TWT.SRC_STM_ID
		FROM TWT_CST_PD_ANL_RM TWT
		INNER JOIN SRC_STM_DIM D ON D.LVL_0_ID =  TWT.SRC_STM_ID 
		INNER JOIN 		CSTB_SYSTEM SYS ON SYS.PARAM_NAME = 'ETL_DATE'
		LEFT JOIN CST_PD_ANL_FCT_PREDAY FCT_PRE ON   FCT_PRE.CST_ID = TWT.CST_ID AND FCT_PRE.PD_ID = TWT.PD_ID AND FCT_PRE.ORG_UNIT_ID = TWT.ORG_UNIT_ID  AND D.SRC_STM_DIM_ID = FCT_PRE.SRC_STM_DIM_ID
)  PD_USG_ST ON PD_USG_ST.CST_ID = TWT.CST_ID AND PD_USG_ST.PD_ID = TWT.PD_ID AND PD_USG_ST.ORG_UNIT_ID = TWT.ORG_UNIT_ID AND PD_USG_ST.SRC_STM_ID = TWT.SRC_STM_ID 

LEFT JOIN PD_USG_ST_DIM ON PD_USG_ST_DIM.LVL_0_CODE = PD_USG_ST.PD_USG_ST_CODE AND PD_USG_ST_DIM.EFF_FM_DT <= TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') AND PD_USG_ST_DIM.EFF_TO_DT > TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')

LEFT JOIN  BAL_SEG_DIM   AST_BAL_SEG ON TWT.CST_AST_BAL_SEG_ID >= AST_BAL_SEG.MIN_BAL AND TWT.CST_AST_BAL_SEG_ID < AST_BAL_SEG.MAX_BAL 
	AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= AST_BAL_SEG.EFF_FM_DT AND AST_BAL_SEG.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')

LEFT JOIN BAL_SEG_DIM   LBY_BAL_SEG ON TWT.CST_LBY_BAL_SEG_ID >= LBY_BAL_SEG.MIN_BAL AND TWT.CST_LBY_BAL_SEG_ID < LBY_BAL_SEG.MAX_BAL 
 AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= LBY_BAL_SEG.EFF_FM_DT AND LBY_BAL_SEG.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')

LEFT JOIN  CR_LMT_SEG_DIM CR_LMT_BAL_SEG ON TWT.CR_LMT_SEG_ID >= CR_LMT_BAL_SEG.MIN_BAL AND TWT.CR_LMT_SEG_ID < CR_LMT_BAL_SEG.MAX_BAL 
	AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= CR_LMT_BAL_SEG.EFF_FM_DT AND CR_LMT_BAL_SEG.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')


LEFT JOIN (SELECT 
				CST_ID, 
				PD_ID,
				NBR_NEW_AR_MTD,
				NBR_NEW_AR_QTD,
				NBR_NEW_AR_YTD,
				NBR_CLS_AR_MTD,
				NBR_CLS_AR_QTD,
				NBR_CLS_AR_YTD,
				TOT_FEE_INCM_AMT_MTD_LCY,
				TOT_FEE_INCM_AMT_QTD_LCY,
				TOT_FEE_INCM_AMT_YTD_LCY,
				TOT_CST_CR_AMT_MTD_LCY
				, TOT_CST_CR_AMT_QTD_LCY
				, TOT_CST_CR_AMT_YTD_LCY
			
				, TOT_CST_DB_AMT_MTD_LCY
				, TOT_CST_DB_AMT_QTD_LCY
				, TOT_CST_DB_AMT_YTD_LCY
			
				, TOT_OTHR_CR_AMT_MTD
				, TOT_OTHR_CR_AMT_QTD
				, TOT_OTHR_CR_AMT_YTD
			
				, TOT_OTHR_DB_AMT_MTD
				, TOT_OTHR_DB_AMT_QTD
				, TOT_OTHR_DB_AMT_YTD
			
				, TOT_NBR_OF_CST_CR_MTD
				, TOT_NBR_OF_CST_CR_QTD
			
				, TOT_NBR_OF_CST_CR_YTD
				, TOT_NBR_OF_CST_DB_MTD
				, TOT_NBR_OF_CST_DB_QTD
			
				, TOT_NBR_OF_CST_DB_YTD
				, TOT_NBR_OF_OTHR_CR_MTD
				, TOT_NBR_OF_OTHR_CR_QTD
			
				, TOT_NBR_OF_OTHR_CR_YTD
				, TOT_NBR_OF_OTHR_DB_MTD
				, TOT_NBR_OF_OTHR_DB_QTD
			
				, TOT_NBR_OF_OTHR_DB_YTD
	
			, NBR_OF_FNC_TXN_MTD
			, NBR_OF_FNC_TXN_QTD
			, NBR_OF_FNC_TXN_YTD
	
			, NBR_OF_NFNC_TXN_MTD
			, NBR_OF_NFNC_TXN_QTD
			, NBR_OF_NFNC_TXN_YTD
			, TOT_NBR_OF_CST_TXN_MTD
			, TOT_NBR_OF_CST_TXN_QTD
			, TOT_NBR_OF_CST_TXN_YTD
			, TOT_ACTV_TXN_CR_AMT_MTD_LCY
			, TOT_ACTV_TXN_CR_AMT_QTD_LCY
			, TOT_ACTV_TXN_CR_AMT_YTD_LCY
			, TOT_ACTV_TXN_DB_AMT_MTD_LCY
			, TOT_ACTV_TXN_DB_AMT_QTD_LCY
			, TOT_ACTV_TXN_DB_AMT_YTD_LCY
			, TOT_PASSIVE_TXN_CR_AMT_MTD_LCY
			, TOT_PASSIVE_TXN_CR_AMT_QTD_LCY
			, TOT_PASSIVE_TXN_CR_AMT_YTD_LCY
		
			, TOT_PASSIVE_TXN_DB_AMT_MTD_LCY
			, TOT_PASSIVE_TXN_DB_AMT_QTD_LCY
			, TOT_PASSIVE_TXN_DB_AMT_YTD_LCY
		
			, TOT_NBR_OF_ACTV_TXN_CR_MTD
			, TOT_NBR_OF_ACTV_TXN_CR_QTD
			, TOT_NBR_OF_ACTV_TXN_CR_YTD
		
			, TOT_NBR_OF_ACTV_TXN_DB_MTD
			, TOT_NBR_OF_ACTV_TXN_DB_QTD
		
			, TOT_NBR_OF_ACTV_TXN_DB_YTD
			, TOT_NBR_OF_PASSIVE_TXN_CR_MTD
			, TOT_NBR_OF_PASSIVE_TXN_CR_QTD
			, TOT_NBR_OF_PASSIVE_TXN_CR_YTD
		
			, TOT_NBR_OF_PASSIVE_TXN_DB_MTD
			, TOT_NBR_OF_PASSIVE_TXN_DB_QTD
			, TOT_NBR_OF_PASSIVE_TXN_DB_YTD			
			, ORG_UNIT_ID
			, LAST_CST_TXN_DT_DIM_ID
	FROM CST_PD_ANL_FCT_PREDAY F
	INNER JOIN SRC_STM_DIM ON SRC_STM_DIM.SRC_STM_DIM_ID = F.SRC_STM_DIM_ID AND SRC_STM_DIM.LVL_0_CODE IN ('SIBS_RMMAST')
) PRE  ON  PRE.CST_ID = TWT.CST_ID    AND PRE.PD_ID = TWT.PD_ID AND PRE.ORG_UNIT_ID = TWT.ORG_UNIT_ID 

LEFT JOIN SLRY_TVR_SEG_DIM ON TWT.SLRY_TVR_ID >= SLRY_TVR_SEG_DIM.MIN_BAL AND TWT.SLRY_TVR_ID < SLRY_TVR_SEG_DIM.MAX_BAL 
	AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= SLRY_TVR_SEG_DIM.EFF_FM_DT AND SLRY_TVR_SEG_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')

LEFT JOIN 		EMPE_DIM EMPE_DIM			ON EMPE_DIM.EMPE_ID = TWT.EMPE_DIM_ID AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= EMPE_DIM.EFF_FM_DT AND EMPE_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN 		CTY_DIM CTY_DIM				ON CTY_DIM.LVL_0_ID = TWT.CTY_OF_RSDNC_DIM_ID  AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= CTY_DIM.EFF_FM_DT AND CTY_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD')
LEFT JOIN TMP_CST_SEG ON TMP_CST_SEG.CST_ID = TWT.CST_ID AND TMP_CST_SEG.TM_PRD_ID = TWT.TM_PRD_ID 
LEFT JOIN 		CST_PD_ST_DIM  CST_PD_ST_BRN_DIM  ON CST_PD_ST_BRN_DIM.LVL_0_CODE = TWT.CST_PD_ST_BRN_CODE AND TO_DATE(SYS.PARAM_VALUE,'YYYYDDD') >= CST_PD_ST_BRN_DIM.EFF_FM_DT AND CST_PD_ST_BRN_DIM.EFF_TO_DT >  TO_DATE(SYS.PARAM_VALUE,'YYYYDDD');

