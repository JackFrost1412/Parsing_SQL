INSERT INTO DMMIS.ADMIN.CNL_TXN_ANL_FCT (
	   AR_RLTNP_OFCR_DIM_ID
       , CTY_OF_RSDNC_DIM_ID
       , CST_BRTH_AGE_SEG_DIM_ID
       , CST_MKT_SEG_DIM_ID
       , CST_RLTNP_OFCR_DIM_ID
       , CST_SLRY_TVR_SEG_DIM_ID
       , CST_TP_DIM_ID
       , CDR_DIM_ID
       , CNL_DIM_ID
       , CNL_TP_DIM_ID
       , CTY_OF_TXN_DIM_ID
       , CCY_DIM_ID
       , CST_DIM_ID
       , GND_DIM_ID
       , IDY_SML_ID_DIM_ID
       , MAR_ST_DIM_ID
       , MRCH_DIM_ID
       , OCP_DIM_ID
       , PRIM_AR_DIM_ID
       , PRIM_ORG_DIM_UNIT_ID
       , PD_DIM_ID
       , SETL_CNL_DIM_ID
       , TXN_CODE_DIM_ID
       , TXN_CR_AMT_FCY
       , TXN_CR_AMT_LCY
       , TXN_DB_AMT_FCY
       , TXN_DB_AMT_LCY
       , TXN_ID
       , TXN_LIFE_CYC_ST_DIM_ID
       , TXN_NTW_DIM_ID
       , TXN_REMARK
       , MRCH_CGY_DIM_ID
       , CNL_TP_PVDR_DIM_ID
       , FEE_TP_DIM_ID
       , TXN_FEE_EXPN_AMT_FCY
       , TXN_FEE_EXPN_AMT_LCY
       , TXN_FEE_INCM_AMT_FCY
       , TXN_FEE_INCM_AMT_LCY
       , TXN_TCKT_NBR
       , PRIM_KEY_ID
       , SRC_STM_DIM_ID
       , TXN_AMT_SEG_DIM_ID
       , CNT_IND
       , CR_X_DB_IND
       , TXN_AMT_IND
       , TXN_DT_TM
       , CARD_TP_ACQ_DIM_ID
       , MRCH_OFCR_EMPE_DIM_ID
       , TXN_ORG_DIM_UNIT_ID
       , MRCH_MGT_DEP_DIM_ID
       , CNL_MGT_DEP_DIM_ID
       , AR_MGT_DEP_DIM_ID
       , CNL_OFCR_EMPE_DIM_ID
       , SCD_AR_DIM_ID
       , ACG_STC_ITM_DIM_ID
       , RQS_CNL_MGT_DEP_DIM_ID
       , PRIM_TXN_AMT_USD
       , SCD_CCY_DIM_ID
       , CDR_MO_DT_DIM_ID
)
SELECT 
	AR_RLTNP_OFCR_DIM_ID
       , CTY_OF_RSDNC_DIM_ID
       , CST_BRTH_AGE_SEG_DIM_ID
       , CST_MKT_SEG_DIM_ID
       , CST_RLTNP_OFCR_DIM_ID
       , CST_SLRY_TVR_SEG_DIM_ID
       , CST_TP_DIM_ID
       , CDR_DIM_ID
       , CNL_DIM_ID
       , CNL_TP_DIM_ID
       , CTY_OF_TXN_DIM_ID
       , CCY_DIM_ID
       , CST_DIM_ID
       , GND_DIM_ID
       , IDY_SML_ID_DIM_ID
       , MAR_ST_DIM_ID
       , MRCH_DIM_ID
       , OCP_DIM_ID
       , PRIM_AR_DIM_ID
       , PRIM_ORG_DIM_UNIT_ID
       , PD_DIM_ID
       , SETL_CNL_DIM_ID
       , TXN_CODE_DIM_ID
       , TXN_CR_AMT_FCY
       , TXN_CR_AMT_LCY
       , TXN_DB_AMT_FCY
       , TXN_DB_AMT_LCY
       , TXN_ID
       , TXN_LIFE_CYC_ST_DIM_ID
       , TXN_NTW_DIM_ID
       , TXN_REMARK
       , MRCH_CGY_DIM_ID
       , CNL_TP_PVDR_DIM_ID
       , FEE_TP_DIM_ID
       , TXN_FEE_EXPN_AMT_FCY
       , TXN_FEE_EXPN_AMT_LCY
       , TXN_FEE_INCM_AMT_FCY
       , TXN_FEE_INCM_AMT_LCY
       , TXN_TCKT_NBR
       , PRIM_KEY_ID
       , SRC_STM_DIM_ID
       , TXN_AMT_SEG_DIM_ID
       , CNT_IND
       , CR_X_DB_IND
       , TXN_AMT_IND
       , TXN_DT_TM
       , CARD_TP_ACQ_DIM_ID
       , MRCH_OFCR_EMPE_DIM_ID
       , TXN_ORG_DIM_UNIT_ID
       , MRCH_MGT_DEP_DIM_ID
       , CNL_MGT_DEP_DIM_ID
       , AR_MGT_DEP_DIM_ID
       , CNL_OFCR_EMPE_DIM_ID
       , SCD_AR_DIM_ID
       , ACG_STC_ITM_DIM_ID
       , RQS_CNL_MGT_DEP_DIM_ID
       , PRIM_TXN_AMT_USD
       , SCD_CCY_DIM_ID
       , CDR_MO_DT_DIM_ID
FROM(
	SELECT NVL(t21.EMPE_DIM_ID, 999999)	AR_RLTNP_OFCR_DIM_ID
		   , NVL(TMP_CST_BAL_LMT_SLRY_AGE_SEG.CST_BRTH_AGE_SEG_DIM_ID, 999999)	CST_BRTH_AGE_SEG_DIM_ID
		   , NVL(TMP_CST_SEG.CST_MKT_SEG_DIM_ID, 999999)						CST_MKT_SEG_DIM_ID
		   , NVL(TMP_CST_BAL_LMT_SLRY_AGE_SEG.CST_RLTNP_OFCR_DIM_ID, 999999)						CST_RLTNP_OFCR_DIM_ID
		   , NVl(TMP_CST_BAL_LMT_SLRY_AGE_SEG.SLRY_TVR_DIM_ID, 999999)						CST_SLRY_TVR_SEG_DIM_ID
		   , NVL(TMP_CST_BAL_LMT_SLRY_AGE_SEG.CST_TP_DIM_ID, 999999)		CST_TP_DIM_ID
		   , t.CDR_DIM_ID			CDR_DIM_ID
		   , NVL(t2.CNL_DIM_ID, 999999)			CNL_DIM_ID
		   , NVL(t3.CNL_TP_DIM_ID, 999999)		CNL_TP_DIM_ID
		   , NVL(t25.CTY_DIM_ID, 999999)		CTY_OF_TXN_DIM_ID
		   , NVL(t4.CCY_DM_ID, 999999)			CCY_DIM_ID
		   , NVL(t5.CST_DIM_ID, 999999)			CST_DIM_ID
		   , NVL(TMP_CST_BAL_LMT_SLRY_AGE_SEG.GND_DIM_ID, 999999)			GND_DIM_ID
		   , NVL(TMP_CST_BAL_LMT_SLRY_AGE_SEG.IDY_SML_ID_DIM_ID, 999999) 	IDY_SML_ID_DIM_ID
		   , NVL(TMP_CST_BAL_LMT_SLRY_AGE_SEG.MAR_ST_DIM_ID, 999999)		MAR_ST_DIM_ID
		   , NVL(t9.MRCH_DIM_ID, 999999)			MRCH_DIM_ID
		   , NVL(TMP_CST_BAL_LMT_SLRY_AGE_SEG.OCP_DIM_ID, 999999)			OCP_DIM_ID
		   , NVL(NVL(t11.AR_DIM_ID, t27.AR_DIM_ID), 999999)			PRIM_AR_DIM_ID
		   , NVL(t12.ORG_UNIT_DIM_ID, 999999)	PRIM_ORG_DIM_UNIT_ID
		   , NVL(t13.PD_DIM_ID, 999999)			PD_DIM_ID
		   , NVL(t14.CNL_DIM_ID, 999999)			SETL_CNL_DIM_ID
		   , NVL(t15.TXN_CODE_DIM_ID, 999999)	TXN_CODE_DIM_ID
		   , t.TXN_CR_AMT_FCY		TXN_CR_AMT_FCY
		   , t.TXN_CR_AMT_LCY		TXN_CR_AMT_LCY
		   , t.TXN_DB_AMT_FCY		TXN_DB_AMT_FCY
		   , t.TXN_DB_AMT_LCY		TXN_DB_AMT_LCY
		   , t.TXN_ID				TXN_ID
		   , NVL(t16.TXN_LIFE_CYC_ST_DIM_ID, 999999)	TXN_LIFE_CYC_ST_DIM_ID
		   , NVL(t17.TXN_NTW_DIM_ID, 999999)		TXN_NTW_DIM_ID
		   , t.TXN_REMARK			TXN_REMARK
		   , NVL(t18.MRCH_CGY_DIM_ID, 999999)	MRCH_CGY_DIM_ID	
		   , NVL(t19.CNL_PVDR_DIM_ID, 999999)	CNL_TP_PVDR_DIM_ID		   , t.FEE_TP_DIM_ID		FEE_TP_DIM_ID		   , t.TXN_FEE_EXPN_AMT_FCY	TXN_FEE_EXPN_AMT_FCY
		   , t.TXN_FEE_EXPN_AMT_LCY	TXN_FEE_EXPN_AMT_LCY
		   , t.TXN_FEE_INCM_AMT_FCY	TXN_FEE_INCM_AMT_FCY
		   , t.TXN_FEE_INCM_AMT_LCY	TXN_FEE_INCM_AMT_LCY
		   , t.TXN_TCKT_NBR			TXN_TCKT_NBR
		   , t.PRIM_KEY_ID			PRIM_KEY_ID
		   , NVL(TMP_CST_BAL_LMT_SLRY_AGE_SEG.CTY_OF_RSDNC_DIM_ID, 999999)			CTY_OF_RSDNC_DIM_ID
		   , NVL(t24.SRC_STM_DIM_ID, 999999)		SRC_STM_DIM_ID
		   , NVL(TXN_AMT_SEG_DIM.TXN_AMT_SEG_DIM_ID, 999999) 	TXN_AMT_SEG_DIM_ID
		   , t.CNT_IND					CNT_IND
		   , t.TXN_AMT_IND				TXN_AMT_IND
		   , t.CR_X_DB_IND			CR_X_DB_IND
		   , t.TXN_DT_TM			TXN_DT_TM
		   , NVL(t26.CARD_TP_ACQ_DIM_ID, 999999)	CARD_TP_ACQ_DIM_ID
		   , NVL(EMPE_DIM.EMPE_DIM_ID, 999999)	MRCH_OFCR_EMPE_DIM_ID
		   , Nvl(OU_DIM.ORG_UNIT_DIM_ID, 999999) TXN_ORG_DIM_UNIT_ID
		   , Nvl(t30.ORG_UNIT_DIM_ID, 999999) MRCH_MGT_DEP_DIM_ID
			, Nvl(t31.ORG_UNIT_DIM_ID, 999999) CNL_MGT_DEP_DIM_ID
			, Nvl(t32.ORG_UNIT_DIM_ID, 999999) AR_MGT_DEP_DIM_ID
			, Nvl(t33.EMPE_DIM_ID, 999999) CNL_OFCR_EMPE_DIM_ID
		   , NVL(t34.AR_DIM_ID, 999999)			SCD_AR_DIM_ID
		   , NVL(t35.ACG_STC_ITM_DIM_ID, 999999)			ACG_STC_ITM_DIM_ID
		   , NVL(RQS_CNL_MGT_DEP.ORG_UNIT_DIM_ID, 999999)	RQS_CNL_MGT_DEP_DIM_ID 		   , t.PRIM_TXN_AMT_USD
		   , NVL(t36.CCY_DM_ID, 999999)			SCD_CCY_DIM_ID
		   , to_char(last_day(to_date(t.CDR_DIM_ID,'yyyyddd')),'yyyyddd')  CDR_MO_DT_DIM_ID
	  FROM TWT_CNL_TXN_ANL_FCT t
	 	 LEFT JOIN CNL_DIM t2 ON t2.CNL_ID = t.CNL_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t2.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t2.EFF_TO_DT
	 LEFT JOIN CNL_TP_DIM t3 ON t3.LVL_0_ID = t.CNL_TP_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t3.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t3.EFF_TO_DT
	 LEFT JOIN CCY_DIM t4 ON t4.CCY_ID = t.CCY_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t4.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t4.EFF_TO_DT
	 LEFT JOIN CST_DIM t5 ON t5.CST_ID = t.CST_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t5.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t5.EFF_TO_DT
	 LEFT JOIN MRCH_DIM t9 ON t9.MRCH_ID = t.MRCH_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t9.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t9.EFF_TO_DT
	 LEFT JOIN AR_DIM t11 ON t11.AR_ID = t.PRIM_AR_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t11.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t11.EFF_TO_DT
	 LEFT JOIN OU_DIM t12 ON t12.ORG_UNIT_ID = t.PRIM_ORG_DIM_UNIT_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t12.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t12.EFF_TO_DT
	 LEFT JOIN PD_DIM t13 ON t13.PD_ID = t.PD_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t13.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t13.EFF_TO_DT
	 LEFT JOIN CNL_DIM t14 ON t14.CNL_ID = t.SETL_CNL_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t14.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t14.EFF_TO_DT
	 LEFT JOIN TXN_CODE_DIM t15 ON t15.LVL_0_ID = t.TXN_CODE_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t15.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t15.EFF_TO_DT
	 LEFT JOIN TXN_LC_ST_DIM t16 ON t16.LVL_0_ID = t.TXN_LIFE_CYC_ST_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t16.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t16.EFF_TO_DT
	 LEFT JOIN TXN_NTW_DIM t17 ON t17.LVL_0_ID = t.TXN_NTW_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t17.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t17.EFF_TO_DT
	 LEFT JOIN MRCH_CGY_DIM t18 ON t18.LVL_0_ID = t.MRCH_CGY_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t18.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t18.EFF_TO_DT
	 LEFT JOIN CNL_TP_PVDR_DIM t19 ON t19.LVL_0_ID = t.CNL_TP_PVDR_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t19.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t19.EFF_TO_DT
	 LEFT JOIN EMPE_DIM t21 ON t21.EMPE_ID = t.AR_RLTNP_OFCR_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t21.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t21.EFF_TO_DT
	LEFT JOIN SRC_STM_DIM t24 ON t24.LVL_0_ID = t.SRC_STM_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t24.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t24.EFF_TO_DT
	 LEFT JOIN CTY_DIM t25 ON t25.LVL_0_ID = t.CTY_OF_TXN_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t25.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t25.EFF_TO_DT

		LEFT JOIN TMP_CST_SEG ON TMP_CST_SEG.CST_ID = t.CST_DIM_ID AND TMP_CST_SEG.TM_PRD_ID = t.CDR_DIM_ID
	  
	LEFT JOIN TXN_AMT_SEG_DIM TXN_AMT_SEG_DIM ON
	   abs(t.TXN_CR_AMT_LCY - t.TXN_DB_AMT_LCY) >= TXN_AMT_SEG_DIM.MIN_BAL AND abs(t.TXN_CR_AMT_LCY - t.TXN_DB_AMT_LCY) < TXN_AMT_SEG_DIM.MAX_BAL
		LEFT JOIN (SELECT DISTINCT PD_ID, CARD_TP_ACQ_LVL_0_ID FROM EX_MAP_CARD_TP_ACQ e
				INNER JOIN CSTB_SYSTEM SYS ON SYS.PARAM_NAME = 'ETL_DATE' 
				where  TO_DATE(:pDate:,'YYYYDDD') >= e.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < e.EFF_TO_DT
				) e ON e.PD_ID = t.PD_DIM_ID
	LEFT JOIN CARD_TP_ACQ_DIM t26 ON t26.LVL_0_ID = e.CARD_TP_ACQ_LVL_0_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t26.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t26.EFF_TO_DT
	LEFT JOIN AR_DIM_SVC t27 ON t27.AR_ID = t.PRIM_AR_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t27.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t27.EFF_TO_DT

	LEFT JOIN admin.TMP_CST_BAL_LMT_SLRY_AGE_SEG on t.CST_DIM_ID = TMP_CST_BAL_LMT_SLRY_AGE_SEG.CST_ID
	LEFT JOIN EMPE_DIM   on EMPE_DIM.EMPE_ID=t.OBJ_IP_ID 
		AND TO_DATE(:pDate:,'YYYYDDD') >= EMPE_DIM.EFF_FM_DT
		AND EMPE_DIM.EFF_TO_DT >  TO_DATE(:pDate:,'YYYYDDD')
	LEFT JOIN OU_DIM ON T.TXN_ORG_UNIT_ID = OU_DIM.ORG_UNIT_ID
		AND OU_DIM.EFF_FM_DT  <= TO_DATE(:pDate:,'YYYYDDD') 
		AND OU_DIM.EFF_TO_DT > TO_DATE(:pDate:,'YYYYDDD')
		LEFT JOIN OU_DIM t30 ON t30.ORG_UNIT_ID = t.MRCH_MGT_DEP_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t30.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t30.EFF_TO_DT
	LEFT JOIN OU_DIM t31 ON t31.ORG_UNIT_ID = t.CNL_MGT_DEP_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t31.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t31.EFF_TO_DT
	LEFT JOIN OU_DIM t32 ON t32.ORG_UNIT_ID = t.AR_MGT_DEP_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t32.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t32.EFF_TO_DT
	LEFT JOIN EMPE_DIM T33 ON T33.EMPE_ID=T.CNL_OFCR_EMPE_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t32.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t32.EFF_TO_DT
	LEFT JOIN OU_DIM RQS_CNL_MGT_DEP ON RQS_CNL_MGT_DEP.ORG_UNIT_ID = t.RQS_CNL_MGT_DEP_ID AND TO_DATE(:pDate:, 'YYYYDDD') BETWEEN RQS_CNL_MGT_DEP.EFF_FM_DT AND RQS_CNL_MGT_DEP.EFF_TO_DT - 1 		LEFT JOIN AR_DIM t34 ON t34.AR_ID = t.SCD_AR_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t34.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t34.EFF_TO_DT
	LEFT JOIN ACG_STC_ITM_DIM t35 ON t35.LVL_0_ID = t.ACG_STC_ITM_DIM_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t35.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t35.EFF_TO_DT 
	LEFT JOIN CCY_DIM t36 ON t36.CCY_ID = t.SCD_CCY_ID
		AND TO_DATE(:pDate:,'YYYYDDD') >= t36.EFF_FM_DT AND TO_DATE(:pDate:,'YYYYDDD') < t36.EFF_TO_DT
) A;

DELETE FROM CNL_TXN_ANL_FCT where CDR_DIM_ID=:pDate:  and FEE_TP_DIM_ID=0;

